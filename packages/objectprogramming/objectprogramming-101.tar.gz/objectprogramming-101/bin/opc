#!/usr/bin/env python3
# This file is placed in the Public Domain.
# pylint: disable=C0115,C0116,C0413


"object programming shell"


import importlib
import os
import sys
import time


sys.path.insert(0, os.getcwd())


from op import Wd
from op.run import Bus, Event, Handler, scan, scandir

from opm import cmds


Wd.workdir = os.path.expanduser("~/.op")


starttime = time.time()


class CLI(Handler):

    def raw(self, txt):
        print(txt)


cli = CLI()


def importer(packagename, modulename):
    name = "%s.%s" % (packagename, modulename)
    try:
        mod = importlib.import_module(name, packagename)
        scan(cli, mod)
    except ModuleNotFoundError:
        pass


def main():
    scandir("mod", importer)
    evt = Event()
    evt.parse(" ".join(sys.argv[1:]))
    evt.orig = repr(cli)
    cli.handle(evt)
    evt.wait()


if __name__ == "__main__":
    main()
