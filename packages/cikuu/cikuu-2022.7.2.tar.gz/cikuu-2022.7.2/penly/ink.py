# 2022.10.2
import requests

bbox	= lambda events={"events": [{"x": [26, 23, 25, 24, 24, 24, 20, 17, 23, 35, 48, 73, 87, 89, 80, 58, 31, 15, 13], "y": [90, 89, 89, 88, 90, 92, 98, 121, 144, 159, 162, 142, 108, 76, 56, 51, 66, 99, 117], "t": [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0]}, {"x": [97, 94, 97, 109, 110, 111, 112, 112, 116, 114, 117, 124, 134, 140, 153, 164, 167, 170, 172, 166, 155], "y": [54, 52, 47, 44, 41, 42, 43, 41, 42, 44, 53, 113, 167, 174, 143, 109, 83, 64, 62, 61, 59], "t": [1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1]}, {"x": [175, 178, 188, 199, 215, 242, 247, 248, 247, 237, 219, 211, 205, 199, 200, 210, 220, 247, 273, 290, 297, 298, 296, 294, 294, 295, 296, 297, 299, 302, 309, 310, 310, 312, 319, 325, 327, 332, 340], "y": [108, 114, 118, 121, 120, 112, 102, 92, 84, 75, 72, 77, 95, 125, 153, 171, 173, 155, 116, 89, 78, 71, 64, 61, 63, 64, 66, 68, 76, 107, 145, 156, 145, 118, 91, 86, 89, 99, 105], "t": [1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2]}, {"x": [410, 423, 399, 381, 377, 384, 392, 405, 424, 444, 448, 449, 447, 448, 447, 448, 448, 450, 456, 467, 482, 489, 492, 490, 478, 450, 445, 444, 459, 481], "y": [81, 50, 62, 85, 135, 166, 173, 174, 150, 134, 126, 125, 125, 125, 125, 128, 131, 141, 157, 166, 169, 149, 133, 117, 102, 91, 94, 99, 110, 102], "t": [2, 2, 2, 2, 2, 2, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3]}, {"x": [527, 532, 532, 534, 535, 534, 526, 524, 526, 531, 535, 546, 558, 568, 569, 571, 570, 577, 578, 578, 579, 582, 586, 594, 604, 613, 614, 615, 616, 618, 615, 616, 614, 614, 625], "y": [89, 82, 79, 81, 84, 102, 134, 140, 139, 132, 113, 90, 75, 64, 64, 67, 71, 97, 114, 117, 117, 114, 108, 91, 74, 60, 58, 59, 63, 82, 111, 133, 162, 156, 124], "t": [3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 4, 4, 4, 4]}, {"x": [655, 655, 659, 668, 681, 696, 710, 718, 718, 715, 709, 698, 670, 655, 652, 681, 710, 724, 728, 733], "y": [84, 87, 93, 96, 95, 90, 82, 70, 57, 52, 48, 47, 57, 96, 145, 175, 174, 168, 160, 128], "t": [4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4]}]}, host='http://ap.penly.cn:18461/' : requests.post( host,data=json.dumps(events)).json() 
avg		= lambda arr: sum(arr) / len(arr) if len(arr) > 0 else 0 
xy_avg	= lambda rows: (round(avg([int(row[0]) for row in rows]),1), round(avg([int(row[1]) for row in rows]),1))  
xyt		= lambda tups,mx=13779,my=19488: { "x": [ int (int(tup[0]) * 5600 / mx) for tup in tups] ,  "y": [ int(int(tup[1]) * 7920/ my ) for tup in tups],  "t": [int(tup[-1]) for tup in tups]}
xyts	= lambda stroke,mx=13779,my=19488: xyt([ s.split(',')  for s in stroke.split(' ')], mx, my)#reco = { "en": 'http://ap.penly.cn:18461/' ,"en_US": 'http://ap.penly.cn:18461/' , "zh_CN":'http://ap.penly.cn:18462/'}

def reco_en( rows:list=["quick:1713.537.31.92:BP2-0L3-03I-4V:1659688120.028:3747,4355,100,1659688120 3746,4355,141,1659688120 3747,4355,516,1659688120 3745,4364,640,1659688120 3745,4384,724,1659688120 3759,4408,752,1659688120 3768,4412,780,1659688120 3770,4402,744,1659688120 3780,4381,736,1659688120 3785,4366,768,1659688120 3782,4353,784,1659688120 3781,4336,792,1659688120 3776,4327,772,1659688120 3768,4330,764,1659688120 3760,4334,776,1659688120 3759,4337,712,1659688120 3750,4350,188,1659688120 3750,4361,188,1659688120",
"quick:1713.537.31.92:BP2-0L3-03I-4V:1659688121.192:3810,4319,100,1659688121 3816,4315,198,1659688121 3819,4316,668,1659688121 3821,4317,740,1659688121 3822,4321,784,1659688121 3825,4328,812,1659688121 3833,4357,820,1659688121 3817,4492,840,1659688121 3813,4490,453,1659688121 3806,4479,104,1659688121",
"quick:1713.537.31.92:BP2-0L3-03I-4V:1659688121.524:3821,4326,100,1659688121 3823,4324,412,1659688121 3835,4324,648,1659688121 3853,4331,708,1659688121 3868,4353,756,1659688121 3871,4378,760,1659688121 3865,4394,796,1659688121 3843,4406,756,1659688121 3820,4411,236,1659688121",
"quick:1713.537.31.92:BP2-0L3-03I-4V:1659688122.02:3891,4369,100,1659688122 3892,4366,501,1659688122 3898,4367,660,1659688122 3902,4368,736,1659688122 3909,4370,784,1659688122 3921,4368,804,1659688122 3935,4360,792,1659688122 3939,4350,728,1659688122 3945,4339,776,1659688122 3937,4336,796,1659688122 3933,4330,816,1659688122 3924,4328,816,1659688122 3914,4331,840,1659688122 3906,4341,856,1659688122 3901,4359,856,1659688122 3902,4383,852,1659688122 3906,4409,852,1659688122 3922,4418,880,1659688122 3928,4417,868,1659688122 3935,4407,820,1659688122 3942,4390,100,1659688122 3944,4373,100,1659688122",
"quick:1713.537.31.92:BP2-0L3-03I-4V:1659688122.588:3978,4319,100,1659688122 3976,4319,277,1659688122 3980,4325,540,1659688122 3979,4329,728,1659688122 3981,4344,828,1659688122 3980,4368,844,1659688122 3977,4385,844,1659688122 3979,4390,880,1659688122 3978,4389,872,1659688122 3977,4383,816,1659688122 3980,4364,740,1659688122 3984,4340,736,1659688122 3986,4330,764,1659688122 3991,4325,780,1659688122 4003,4318,796,1659688122 4011,4314,816,1659688122 4023,4313,816,1659688122 4029,4315,832,1659688122 4031,4317,816,1659688122 4032,4321,828,1659688122 4031,4323,872,1659688122 4032,4327,876,1659688122 4032,4333,900,1659688123 4033,4358,876,1659688123 4033,4373,868,1659688123 4033,4386,856,1659688123 4029,4405,860,1659688123 4040,4417,888,1659688123 4036,4416,872,1659688123 4034,4411,744,1659688123 4027,4399,252,1659688123 3994,4370,252,1659688123",
], max_x:int=13779, max_y:int=19488, host:str='http://ap.penly.cn:18461/' ):
	events	= {"events": [xyts(row.split(':')[-1], max_x, max_y) for row in rows ] }
	bbox	= requests.post( host,data=json.dumps(events)).json() 
	return bbox #label	= bbox.get('label','') # add cands later 
# print ( reco_en_strokes()) {'type': 'Text', 'bounding-box': {'x': 25.8803864, 'y': 23.2417908, 'width': 20.1695213, 'height': 8.2792263}, 'label': 'open', 'words': [{'label': 'open', 'candidates': ['open', 'Open', 'opens', 'oper', 'opera'], 'bounding-box': {'x': 25.8803864, 'y': 23.2417908, 'width': 20.1695213, 'height': 8.2792263}, 'items': [{'type': 'glyph', 'timestamp': '1970-01-20 06:12:16.413000', 'label': 'o', 'bounding-box': {'x': 26.8803864, 'y': 24.2417908, 'width': 4.16685867, 'height': 4.43142128}, 'baseline': 0.977611899, 'x-height': 0.955223978, 'left-side-bearing': -0.0952381045, 'id': '000031a901000700ff00'}, {'type': 'glyph', 'timestamp': '1970-01-20 06:12:16.413000', 'label': 'p', 'bounding-box': {'x': 32.130703, 'y': 24.2417908, 'width': 3.89403152, 'height': 6.2792263}, 'baseline': 0.689927518, 'x-height': 0.674127758, 'left-side-bearing': -0.176220804, 'id': '000032a901000700ff00'}, {'type': 'glyph', 'timestamp': '1970-01-20 06:12:16.413000', 'label': 'e', 'bounding-box': {'x': 36.8192177, 'y': 24.2417908, 'width': 3.69147491, 'height': 4.43142128}, 'baseline': 0.977611899, 'x-height': 0.955223978, 'left-side-bearing': -0.107502803, 'id': '000033a901000700ff00'}, {'type': 'glyph', 'timestamp': '1970-01-20 06:12:16.413000', 'label': 'n', 'bounding-box': {'x': 41.5361862, 'y': 24.2417908, 'width': 3.51372147, 'height': 4.33221054}, 'baseline': 0.999999762, 'x-height': 0.97709918, 'left-side-bearing': -0.195294127, 'id': '000034a901000700ff00'}]}], 'version': '2', 'id': 'MainBlock'}

if __name__ == '__main__': 
	print (reco_en()) 