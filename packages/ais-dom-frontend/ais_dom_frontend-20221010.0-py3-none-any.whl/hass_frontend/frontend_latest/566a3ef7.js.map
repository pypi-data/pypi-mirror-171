{"version":3,"file":"566a3ef7.js","mappings":";AAgDA;AACA;;;AAGA;AACA;AACA;AACA;AACA;AACA;AACA;;;;AAjDA;;;;;;;;AAAA;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;ACLA;AAoEA;;AApEA;;;;ACsDA;;AAEA;;;;AAsBA;;AAEA;AAqCA;AAIA;;;;AAkBA;;AAEA;;;;AAsBA;;AAEA;AC7HA;;;;;AAKA;;;AAGA;;;;;;;AAOA;;;;;;;AAOA;;;;AAMA;AACA;AACA;;;AAGA;;;;;AAKA;AACA;AACA;;;;;AAKA;AACA;;;;;AAOA;;;;;;;;;;;;;;;;;;;;;;;AA5EA;;ACgBA;;;;AAIA;AAGA;AACA;AACA;;;AAGA;AACA;;;AAGA;;;;AAMA;;AAGA;AASA;;AAEA;AACA;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAhEA","sources":["webpack://home-assistant-frontend/./src/components/ha-button-menu.ts","webpack://home-assistant-frontend/./src/components/ha-card.ts","webpack://home-assistant-frontend/./src/dialogs/config-flow/show-dialog-options-flow.ts","webpack://home-assistant-frontend/./src/panels/config/integrations/integration-panels/mqtt/mqtt-config-panel.ts","webpack://home-assistant-frontend/./src/panels/config/integrations/integration-panels/mqtt/mqtt-subscribe-card.ts"],"sourcesContent":["import type { Button } from \"@material/mwc-button\";\nimport \"@material/mwc-menu\";\nimport type { Corner, Menu, MenuCorner } from \"@material/mwc-menu\";\nimport { css, CSSResultGroup, html, LitElement, TemplateResult } from \"lit\";\nimport { customElement, property, query } from \"lit/decorators\";\nimport { FOCUS_TARGET } from \"../dialogs/make-dialog-manager\";\nimport type { HaIconButton } from \"./ha-icon-button\";\n\n@customElement(\"ha-button-menu\")\nexport class HaButtonMenu extends LitElement {\n  protected readonly [FOCUS_TARGET];\n\n  @property() public corner: Corner = \"TOP_START\";\n\n  @property() public menuCorner: MenuCorner = \"START\";\n\n  @property({ type: Number }) public x: number | null = null;\n\n  @property({ type: Number }) public y: number | null = null;\n\n  @property({ type: Boolean }) public multi = false;\n\n  @property({ type: Boolean }) public activatable = false;\n\n  @property({ type: Boolean }) public disabled = false;\n\n  @property({ type: Boolean }) public fixed = false;\n\n  @query(\"mwc-menu\", true) private _menu?: Menu;\n\n  public get items() {\n    return this._menu?.items;\n  }\n\n  public get selected() {\n    return this._menu?.selected;\n  }\n\n  public override focus() {\n    if (this._menu?.open) {\n      this._menu.focusItemAtIndex(0);\n    } else {\n      this._triggerButton?.focus();\n    }\n  }\n\n  protected render(): TemplateResult {\n    return html`\n      <div @click=${this._handleClick}>\n        <slot name=\"trigger\" @slotchange=${this._setTriggerAria}></slot>\n      </div>\n      <mwc-menu\n        .corner=${this.corner}\n        .menuCorner=${this.menuCorner}\n        .fixed=${this.fixed}\n        .multi=${this.multi}\n        .activatable=${this.activatable}\n        .y=${this.y}\n        .x=${this.x}\n      >\n        <slot></slot>\n      </mwc-menu>\n    `;\n  }\n\n  protected firstUpdated(changedProps): void {\n    super.firstUpdated(changedProps);\n\n    if (document.dir === \"rtl\") {\n      this.updateComplete.then(() => {\n        this.querySelectorAll(\"mwc-list-item\").forEach((item) => {\n          const style = document.createElement(\"style\");\n          style.innerHTML =\n            \"span.material-icons:first-of-type { margin-left: var(--mdc-list-item-graphic-margin, 32px) !important; margin-right: 0px !important;}\";\n          item!.shadowRoot!.appendChild(style);\n        });\n      });\n    }\n  }\n\n  private _handleClick(): void {\n    if (this.disabled) {\n      return;\n    }\n    this._menu!.anchor = this;\n    this._menu!.show();\n  }\n\n  private get _triggerButton() {\n    return this.querySelector(\n      'ha-icon-button[slot=\"trigger\"], mwc-button[slot=\"trigger\"]'\n    ) as HaIconButton | Button | null;\n  }\n\n  private _setTriggerAria() {\n    if (this._triggerButton) {\n      this._triggerButton.ariaHasPopup = \"menu\";\n    }\n  }\n\n  static get styles(): CSSResultGroup {\n    return css`\n      :host {\n        display: inline-block;\n        position: relative;\n      }\n      ::slotted([disabled]) {\n        color: var(--disabled-text-color);\n      }\n    `;\n  }\n}\n\ndeclare global {\n  interface HTMLElementTagNameMap {\n    \"ha-button-menu\": HaButtonMenu;\n  }\n}\n","import { css, CSSResultGroup, html, LitElement, TemplateResult } from \"lit\";\nimport { customElement, property } from \"lit/decorators\";\n\n@customElement(\"ha-card\")\nexport class HaCard extends LitElement {\n  @property() public header?: string;\n\n  @property({ type: Boolean, reflect: true }) public outlined = false;\n\n  static get styles(): CSSResultGroup {\n    return css`\n      :host {\n        background: var(\n          --ha-card-background,\n          var(--card-background-color, white)\n        );\n        border-radius: var(--ha-card-border-radius, 4px);\n        box-shadow: var(\n          --ha-card-box-shadow,\n          0px 2px 1px -1px rgba(0, 0, 0, 0.2),\n          0px 1px 1px 0px rgba(0, 0, 0, 0.14),\n          0px 1px 3px 0px rgba(0, 0, 0, 0.12)\n        );\n        color: var(--primary-text-color);\n        display: block;\n        transition: all 0.3s ease-out;\n        position: relative;\n      }\n\n      :host([outlined]) {\n        box-shadow: none;\n        border-width: var(--ha-card-border-width, 1px);\n        border-style: solid;\n        border-color: var(\n          --ha-card-border-color,\n          var(--divider-color, #e0e0e0)\n        );\n      }\n\n      .card-header,\n      :host ::slotted(.card-header) {\n        color: var(--ha-card-header-color, --primary-text-color);\n        font-family: var(--ha-card-header-font-family, inherit);\n        font-size: var(--ha-card-header-font-size, 24px);\n        letter-spacing: -0.012em;\n        line-height: 48px;\n        padding: 12px 16px 16px;\n        display: block;\n        margin-block-start: 0px;\n        margin-block-end: 0px;\n        font-weight: normal;\n      }\n\n      :host ::slotted(.card-content:not(:first-child)),\n      slot:not(:first-child)::slotted(.card-content) {\n        padding-top: 0px;\n        margin-top: -8px;\n      }\n\n      :host ::slotted(.card-content) {\n        padding: 16px;\n      }\n\n      :host ::slotted(.card-actions) {\n        border-top: 1px solid var(--divider-color, #e8e8e8);\n        padding: 5px 16px;\n      }\n    `;\n  }\n\n  protected render(): TemplateResult {\n    return html`\n      ${this.header\n        ? html`<h1 class=\"card-header\">${this.header}</h1>`\n        : html``}\n      <slot></slot>\n    `;\n  }\n}\n\ndeclare global {\n  interface HTMLElementTagNameMap {\n    \"ha-card\": HaCard;\n  }\n}\n","import { html } from \"lit\";\nimport { ConfigEntry } from \"../../data/config_entries\";\nimport { domainToName, IntegrationManifest } from \"../../data/integration\";\nimport {\n  createOptionsFlow,\n  deleteOptionsFlow,\n  fetchOptionsFlow,\n  handleOptionsFlowStep,\n} from \"../../data/options_flow\";\nimport {\n  loadDataEntryFlowDialog,\n  showFlowDialog,\n} from \"./show-dialog-data-entry-flow\";\n\nexport const loadOptionsFlowDialog = loadDataEntryFlowDialog;\n\nexport const showOptionsFlowDialog = (\n  element: HTMLElement,\n  configEntry: ConfigEntry,\n  manifest?: IntegrationManifest | null\n): void =>\n  showFlowDialog(\n    element,\n    {\n      startFlowHandler: configEntry.entry_id,\n      domain: configEntry.domain,\n      manifest,\n    },\n    {\n      loadDevicesAndAreas: false,\n      createFlow: async (hass, handler) => {\n        const [step] = await Promise.all([\n          createOptionsFlow(hass, handler),\n          hass.loadBackendTranslation(\"options\", configEntry.domain),\n        ]);\n        return step;\n      },\n      fetchFlow: async (hass, flowId) => {\n        const [step] = await Promise.all([\n          fetchOptionsFlow(hass, flowId),\n          hass.loadBackendTranslation(\"options\", configEntry.domain),\n        ]);\n        return step;\n      },\n      handleFlowStep: handleOptionsFlowStep,\n      deleteFlow: deleteOptionsFlow,\n\n      renderAbortDescription(hass, step) {\n        const description = hass.localize(\n          `component.${configEntry.domain}.options.abort.${step.reason}`,\n          step.description_placeholders\n        );\n\n        return description\n          ? html`\n              <ha-markdown\n                breaks\n                allowsvg\n                .content=${description}\n              ></ha-markdown>\n            `\n          : \"\";\n      },\n\n      renderShowFormStepHeader(hass, step) {\n        return (\n          hass.localize(\n            `component.${configEntry.domain}.options.step.${step.step_id}.title`\n          ) || hass.localize(`ui.dialogs.options_flow.form.header`)\n        );\n      },\n\n      renderShowFormStepDescription(hass, step) {\n        const description = hass.localize(\n          `component.${configEntry.domain}.options.step.${step.step_id}.description`,\n          step.description_placeholders\n        );\n        return description\n          ? html`\n              <ha-markdown\n                allowsvg\n                breaks\n                .content=${description}\n              ></ha-markdown>\n            `\n          : \"\";\n      },\n\n      renderShowFormStepFieldLabel(hass, step, field) {\n        return hass.localize(\n          `component.${configEntry.domain}.options.step.${step.step_id}.data.${field.name}`\n        );\n      },\n\n      renderShowFormStepFieldHelper(hass, step, field) {\n        const description = hass.localize(\n          `component.${configEntry.domain}.options.step.${step.step_id}.data_description.${field.name}`,\n          step.description_placeholders\n        );\n        return description\n          ? html`<ha-markdown breaks .content=${description}></ha-markdown>`\n          : \"\";\n      },\n\n      renderShowFormStepFieldError(hass, step, error) {\n        return hass.localize(\n          `component.${configEntry.domain}.options.error.${error}`,\n          step.description_placeholders\n        );\n      },\n\n      renderExternalStepHeader(_hass, _step) {\n        return \"\";\n      },\n\n      renderExternalStepDescription(_hass, _step) {\n        return \"\";\n      },\n\n      renderCreateEntryDescription(hass, _step) {\n        return html`\n          <p>${hass.localize(`ui.dialogs.options_flow.success.description`)}</p>\n        `;\n      },\n\n      renderShowFormProgressHeader(hass, step) {\n        return (\n          hass.localize(\n            `component.${configEntry.domain}.options.step.${step.step_id}.title`\n          ) || hass.localize(`component.${configEntry.domain}.title`)\n        );\n      },\n\n      renderShowFormProgressDescription(hass, step) {\n        const description = hass.localize(\n          `component.${configEntry.domain}.options.progress.${step.progress_action}`,\n          step.description_placeholders\n        );\n        return description\n          ? html`\n              <ha-markdown\n                allowsvg\n                breaks\n                .content=${description}\n              ></ha-markdown>\n            `\n          : \"\";\n      },\n\n      renderMenuHeader(hass, step) {\n        return (\n          hass.localize(\n            `component.${configEntry.domain}.options.step.${step.step_id}.title`\n          ) || hass.localize(`component.${configEntry.domain}.title`)\n        );\n      },\n\n      renderMenuDescription(hass, step) {\n        const description = hass.localize(\n          `component.${configEntry.domain}.options.step.${step.step_id}.description`,\n          step.description_placeholders\n        );\n        return description\n          ? html`\n              <ha-markdown\n                allowsvg\n                breaks\n                .content=${description}\n              ></ha-markdown>\n            `\n          : \"\";\n      },\n\n      renderMenuOption(hass, step, option) {\n        return hass.localize(\n          `component.${configEntry.domain}.options.step.${step.step_id}.menu_options.${option}`,\n          step.description_placeholders\n        );\n      },\n\n      renderLoadingDescription(hass, reason) {\n        return (\n          hass.localize(`component.${configEntry.domain}.options.loading`) ||\n          hass.localize(`ui.dialogs.options_flow.loading.${reason}`, {\n            integration: domainToName(hass.localize, configEntry.domain),\n          })\n        );\n      },\n    }\n  );\n","import \"@material/mwc-list/mwc-list-item\";\nimport \"../../../../../components/ha-button-menu\";\nimport \"@material/mwc-button\";\nimport \"@polymer/paper-input/paper-input\";\nimport { css, CSSResultGroup, html, LitElement, TemplateResult } from \"lit\";\nimport { customElement, property, state } from \"lit/decorators\";\nimport \"../../../../../components/ha-card\";\nimport \"../../../../../components/ha-code-editor\";\nimport { mdiDotsVertical } from \"@mdi/js\";\nimport { getConfigEntries } from \"../../../../../data/config_entries\";\nimport { showOptionsFlowDialog } from \"../../../../../dialogs/config-flow/show-dialog-options-flow\";\nimport \"../../../../../layouts/hass-subpage\";\nimport { haStyle } from \"../../../../../resources/styles\";\nimport { HomeAssistant } from \"../../../../../types\";\nimport \"./mqtt-subscribe-card\";\nimport {\n  showAisFileDialog,\n  HaAisFileDialogParams,\n} from \"../../../../../dialogs/ais-files/show-dialog-ais-file\";\n\n@customElement(\"mqtt-config-panel\")\nclass HaPanelDevMqtt extends LitElement {\n  @property({ attribute: false }) public hass!: HomeAssistant;\n\n  @property({ type: Boolean }) public narrow!: boolean;\n\n  @state() private topic = \"\";\n\n  @state() private payload = \"\";\n\n  private inited = false;\n\n  protected firstUpdated() {\n    if (localStorage && localStorage[\"panel-dev-mqtt-topic\"]) {\n      this.topic = localStorage[\"panel-dev-mqtt-topic\"];\n    }\n    if (localStorage && localStorage[\"panel-dev-mqtt-payload\"]) {\n      this.payload = localStorage[\"panel-dev-mqtt-payload\"];\n    }\n    this.inited = true;\n  }\n\n  protected render(): TemplateResult {\n    return html`\n      <hass-subpage .narrow=${this.narrow} .hass=${this.hass}>\n        <ha-button-menu corner=\"BOTTOM_START\" slot=\"toolbar-icon\">\n          <mwc-icon-button slot=\"trigger\" alt=\"menu\">\n            <ha-svg-icon .path=${mdiDotsVertical}></ha-svg-icon>\n          </mwc-icon-button>\n          <mwc-list-item @click=${this._openMosquittoFile}>\n            Edit mosquitto.conf\n          </mwc-list-item>\n          <mwc-list-item @click=${this._restartMosquittoService}>\n            Restart MQTT sevice\n          </mwc-list-item>\n        </ha-button-menu>\n        <div class=\"content\">\n          <ha-card header=\"Ustawienia MQTT\">\n            <div class=\"card-actions\">\n              <mwc-button @click=${this._openOptionFlow}\n                >Re-konfiguracja połączenia MQTT</mwc-button\n              >\n            </div>\n          </ha-card>\n\n          <ha-card\n            header=${this.hass.localize(\n              \"ui.panel.config.mqtt.description_publish\"\n            )}\n          >\n            <div class=\"card-content\">\n              <paper-input\n                label=${this.hass.localize(\"ui.panel.config.mqtt.topic\")}\n                .value=${this.topic}\n                @value-changed=${this._handleTopic}\n              ></paper-input>\n\n              <p>${this.hass.localize(\"ui.panel.config.mqtt.payload\")}</p>\n              <ha-code-editor\n                mode=\"jinja2\"\n                autocomplete-entities\n                autocomplete-icons\n                .hass=${this.hass}\n                .value=${this.payload}\n                @value-changed=${this._handlePayload}\n                dir=\"ltr\"\n              ></ha-code-editor>\n            </div>\n            <div class=\"card-actions\">\n              <mwc-button @click=${this._publish}\n                >${this.hass.localize(\n                  \"ui.panel.config.mqtt.publish\"\n                )}</mwc-button\n              >\n            </div>\n          </ha-card>\n\n          <mqtt-subscribe-card .hass=${this.hass}></mqtt-subscribe-card>\n        </div>\n      </hass-subpage>\n    `;\n  }\n\n  private _handleTopic(ev: CustomEvent) {\n    this.topic = ev.detail.value;\n    if (localStorage && this.inited) {\n      localStorage[\"panel-dev-mqtt-topic\"] = this.topic;\n    }\n  }\n\n  private _handlePayload(ev: CustomEvent) {\n    this.payload = ev.detail.value;\n    if (localStorage && this.inited) {\n      localStorage[\"panel-dev-mqtt-payload\"] = this.payload;\n    }\n  }\n\n  private _publish(): void {\n    if (!this.hass) {\n      return;\n    }\n    this.hass.callService(\"mqtt\", \"publish\", {\n      topic: this.topic,\n      payload_template: this.payload,\n    });\n  }\n\n  private async _openOptionFlow() {\n    const searchParams = new URLSearchParams(window.location.search);\n    if (!searchParams.has(\"config_entry\")) {\n      return;\n    }\n    const configEntryId = searchParams.get(\"config_entry\") as string;\n    const configEntries = await getConfigEntries(this.hass, {\n      domain: \"mqtt\",\n    });\n    const configEntry = configEntries.find(\n      (entry) => entry.entry_id === configEntryId\n    );\n    showOptionsFlowDialog(this, configEntry!);\n  }\n\n  private async _openMosquittoFile() {\n    const filePath =\n      \"/data/data/com.termux/files/usr/etc/mosquitto/mosquitto.conf\";\n    const file = await this.hass.callApi<string>(\"POST\", \"ais_file/read\", {\n      filePath: filePath,\n    });\n    const fileParams: HaAisFileDialogParams = {\n      dialogTitle: \"MQTT mosquitto.conf\",\n      filePath: filePath,\n      fileBody: file,\n      readonly: false,\n    };\n    showAisFileDialog(this, fileParams);\n  }\n\n  private async _restartMosquittoService() {\n    this.hass.callService(\"ais_shell_command\", \"restart_pm2_service\", {\n      service: \"mqtt\",\n    });\n  }\n\n  static get styles(): CSSResultGroup {\n    return [\n      haStyle,\n      css`\n        :host {\n          -ms-user-select: initial;\n          -webkit-user-select: initial;\n          -moz-user-select: initial;\n        }\n\n        .content {\n          padding: 24px 0 32px;\n          max-width: 600px;\n          margin: 0 auto;\n          direction: ltr;\n        }\n        ha-card:first-child {\n          margin-bottom: 16px;\n        }\n        mqtt-subscribe-card {\n          display: block;\n          margin: 16px auto;\n        }\n      `,\n    ];\n  }\n}\n\ndeclare global {\n  interface HTMLElementTagNameMap {\n    \"developer-tools-mqtt\": HaPanelDevMqtt;\n  }\n}\n","import \"@material/mwc-button\";\nimport \"@polymer/paper-input/paper-input\";\nimport { css, CSSResultGroup, html, LitElement, TemplateResult } from \"lit\";\nimport { customElement, property, state } from \"lit/decorators\";\nimport { formatTime } from \"../../../../../common/datetime/format_time\";\nimport \"../../../../../components/ha-card\";\nimport { MQTTMessage, subscribeMQTTTopic } from \"../../../../../data/mqtt\";\nimport { HomeAssistant } from \"../../../../../types\";\n\n@customElement(\"mqtt-subscribe-card\")\nclass MqttSubscribeCard extends LitElement {\n  @property({ attribute: false }) public hass!: HomeAssistant;\n\n  @state() private _topic = \"\";\n\n  @state() private _subscribed?: () => void;\n\n  @state() private _messages: Array<{\n    id: number;\n    message: MQTTMessage;\n    payload: string;\n    time: Date;\n  }> = [];\n\n  private _messageCount = 0;\n\n  public disconnectedCallback() {\n    super.disconnectedCallback();\n    if (this._subscribed) {\n      this._subscribed();\n      this._subscribed = undefined;\n    }\n  }\n\n  protected render(): TemplateResult {\n    return html`\n      <ha-card\n        header=${this.hass.localize(\"ui.panel.config.mqtt.description_listen\")}\n      >\n        <form>\n          <paper-input\n            .label=${this._subscribed\n              ? this.hass.localize(\"ui.panel.config.mqtt.listening_to\")\n              : this.hass.localize(\"ui.panel.config.mqtt.subscribe_to\")}\n            .disabled=${this._subscribed !== undefined}\n            .value=${this._topic}\n            @value-changed=${this._valueChanged}\n          ></paper-input>\n          <mwc-button\n            .disabled=${this._topic === \"\"}\n            @click=${this._handleSubmit}\n            type=\"submit\"\n          >\n            ${this._subscribed\n              ? this.hass.localize(\"ui.panel.config.mqtt.stop_listening\")\n              : this.hass.localize(\"ui.panel.config.mqtt.start_listening\")}\n          </mwc-button>\n        </form>\n        <div class=\"events\">\n          ${this._messages.map(\n            (msg) => html`\n              <div class=\"event\">\n                ${this.hass.localize(\n                  \"ui.panel.config.mqtt.message_received\",\n                  \"id\",\n                  msg.id,\n                  \"topic\",\n                  msg.message.topic,\n                  \"time\",\n                  formatTime(msg.time, this.hass!.locale)\n                )}\n                <pre>${msg.payload}</pre>\n                <div class=\"bottom\">\n                  QoS: ${msg.message.qos} - Retain:\n                  ${Boolean(msg.message.retain)}\n                </div>\n              </div>\n            `\n          )}\n        </div>\n      </ha-card>\n    `;\n  }\n\n  private _valueChanged(ev: CustomEvent): void {\n    this._topic = ev.detail.value;\n  }\n\n  private async _handleSubmit(): Promise<void> {\n    if (this._subscribed) {\n      this._subscribed();\n      this._subscribed = undefined;\n    } else {\n      this._subscribed = await subscribeMQTTTopic(\n        this.hass!,\n        this._topic,\n        (message) => this._handleMessage(message)\n      );\n    }\n  }\n\n  private _handleMessage(message: MQTTMessage) {\n    const tail =\n      this._messages.length > 30 ? this._messages.slice(0, 29) : this._messages;\n    let payload: string;\n    try {\n      payload = JSON.stringify(JSON.parse(message.payload), null, 4);\n    } catch (err: any) {\n      payload = message.payload;\n    }\n    this._messages = [\n      {\n        payload,\n        message,\n        time: new Date(),\n        id: this._messageCount++,\n      },\n      ...tail,\n    ];\n  }\n\n  static get styles(): CSSResultGroup {\n    return css`\n      form {\n        display: block;\n        padding: 16px;\n      }\n      paper-input {\n        display: inline-block;\n        width: 200px;\n      }\n      .events {\n        margin: -16px 0;\n        padding: 0 16px;\n      }\n      .event {\n        border-bottom: 1px solid var(--divider-color);\n        padding-bottom: 16px;\n        margin: 16px 0;\n      }\n      .event:last-child {\n        border-bottom: 0;\n      }\n      .bottom {\n        font-size: 80%;\n        color: var(--secondary-text-color);\n      }\n      pre {\n        font-family: var(--code-font-family, monospace);\n      }\n    `;\n  }\n}\n\ndeclare global {\n  interface HTMLElementTagNameMap {\n    \"mqtt-subscribe-card\": MqttSubscribeCard;\n  }\n}\n"],"names":[],"sourceRoot":""}