[tox]
envlist = check,py37,py38,py39,py310,pypy3,coverage
skip_missing_interpreters = true

[testenv]
usedevelop = true
setenv =
    COVERAGE_FILE={toxinidir}/.coverage/.cov_{envname}

deps =
    -rrequirements_testenv.txt

whitelist_externals =
    rm
    mkdir
commands =
    mkdir -p {toxinidir}/.coverage
    rm -vf {toxinidir}/.coverage/.cov_{envname}
    py.test --cov-report= --cov . {posargs}


[testenv:check]
deps =
    docutils
    check-manifest
    flake8
    readme-renderer
    twine

commands =
    flake8 grot setup.py
    check-manifest
    python setup.py sdist
    twine check dist/*


[testenv:coverage]
usedevelop = true

whitelist_externals =
    bash
deps =
    pytest-cov
commands =
    bash -c 'coverage combine {toxinidir}/.coverage/.cov_*'
    coverage report -i -m
    coverage html -i


[flake8]
max-line-length = 120
ignore = W191, E101
# E101: indentation contains mixed spaces and tabs
# W191: indentation contains tabs


[coverage:run]
source =
    grot/*
omit =
    setup.py
    examples/*
    tests/*
    .tox/*
    .git/*
parallel = true

[pytest]
python_files = test_*.py example_*.py
python_functions = test_* example_*
