# automatically generated by auxilium
FROM {{ opts.base | default("python:"~aux.project.minimal_version~"-slim-bullseye", true) }}

ENV PYTHONUNBUFFERED 1
ENV DEBIAN_FRONTEND noninteractive

{% include 'apt_install.jinja2' -%}
{% include 'extra_script.jinja2' -%}

# create non-root-user
RUN addgroup --gid 5000 container
RUN useradd --create-home --uid 5000 --gid 5000 --shell /bin/bash container
ENV PATH=$PATH:/home/container/.local/bin
USER container:container
WORKDIR /home/container

{% include 'pip_install.jinja2' -%}

ENV ANSIBLE_HOST_KEY_CHECKING=False
CMD ["/bin/sh", "-c", "eval $(ssh-agent -s -a ~/ssh_agent_socket) > /dev/null ; echo $VAULT_PASSWORD > .vault_pass ; ansible-playbook --vault-password-file=.vault_pass deploy.yml; rm -f .vault_pass"]
